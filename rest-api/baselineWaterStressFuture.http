@host = https://api.resourcewatch.org/v1
@token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzYzcwOTBiZTU5MTU5NmYyN2MxOThjYSIsInJvbGUiOiJBRE1JTiIsInByb3ZpZGVyIjoibG9jYWwiLCJlbWFpbCI6IkNhcmxvcy5EZWxSZWFsLjVAd3JpY29uc3VsdGFudC5vcmciLCJleHRyYVVzZXJEYXRhIjp7ImFwcHMiOlsicnciLCJhcXVlZHVjdCIsImFxdWVkdWN0LXdhdGVyLXJpc2siXX0sImNyZWF0ZWRBdCI6MTY4Njc3NTUyNTAyNSwicGhvdG8iOiJodHRwczovL3MzLmFtYXpvbmF3cy5jb20vd3JpLWFwaS1iYWNrdXBzL3Jlc291cmNld2F0Y2gvc3RhZ2luZy9wcm9maWxlcy9hdmF0YXJzLzAwMC8wMDAvMjU4L29yaWdpbmFsL2RhdGE_MTY3NDA2ODA0NyIsIm5hbWUiOiJDYXJsb3MgRGVsIFJlYWwiLCJpYXQiOjE2ODY3NzU1MjV9.3J7HR6Et_5wmJbbfjnh_7ZvrClzIsRAdwaqMJEMmOuM


POST {{host}}/dataset/0f2cec21-135b-4e2c-8cf8-79e8c2070284/layer
Content-Type: application/json
Authorization: {{token}}

{
   "name":"Baseline water stress future",
   "application":[
      "aqueduct"
   ],
   "provider":"cartodb",
   "layerConfig":{
      "params_config":[
         {
            "required":true,
            "key":"period"
         }
      ],
      "body":{
         "layers":[
            {
               "type":"cartodb",
               "options":{
                  "sql":"with r as (SELECT * FROM aqueduct_results_country_future_2023 WHERE indicator_name = 'bws' AND scenario = 'opt' AND weight = 'Tot' AND period = {{period}}) SELECT a.the_geom, a.the_geom_webmercator, a.cartodb_id, r.gid_0, coalesce(NULLIF(r.name_0, ''), 'No Data') as name_0, r.indicator_name, r.score, coalesce(r.cat, -9999) as cat, (CASE WHEN label = 'NoData' THEN 'No Data' ELSE coalesce(NULLIF(r.label, ''), 'No Data') END) as label FROM gadm_wri_0 a LEFT JOIN r on a.gid_0 = r.gid_0 WHERE a.gid_0 != 'ATA'",
                  "cartocss":"#layer{\n  polygon-fill:transparent;\n  polygon-opacity: 1;\n  line-color:transparent;\n  line-width: 1;\n  line-opacity: 1;\n}\n#layer [cat=4] { polygon-fill: #990000; line-color: #990000 }\n#layer [cat=3] { polygon-fill: #FF1900; line-color: #FF1900 }\n#layer [cat=2] { polygon-fill: #FF9900; line-color: #FF9900 }\n#layer [cat=1] { polygon-fill: #FFE600; line-color: #FFE600 }\n#layer [cat=0] { polygon-fill: #FFFF99; line-color: #FFFF99 }\n#layer [cat<-1] { polygon-fill: #4E4E4E; line-color:  #4E4E4E }\n\n#layer::boundaries{\n polygon-fill:transparent; polygon-opacity: 1; line-color:#CFCFCB; line-width: 2; line-opacity: 1;\n}",
                  "cartocss_version":"2.3.0"
               }
            }
         ]
      },
      "account":"wri-rw"
   },
   "legendConfig":{
      "type":"choropleth",
      "disclaimer":[
         {
            "color":"#4E4E4E",
            "name":"No data"
         }
      ],
      "items":[
         {
            "color":"#FFFF99",
            "value":"(0-1)",
            "name":"Low"
         },
         {
            "color":"#FFE600",
            "value":"(1-2)",
            "name":"Low-medium"
         },
         {
            "color":"#FF9900",
            "value":"(2-3)",
            "name":"Medium-high"
         },
         {
            "color":"#FF1900",
            "value":"(3-4)",
            "name":"High"
         },
         {
            "color":"#990000",
            "value":"(4-5)",
            "name":"Extremely-high"
         }
      ]
   },
   "interactionConfig":{
      "output":[
         {
            "column":"name_0",
            "format":null,
            "prefix":"",
            "property":"Country",
            "suffix":"",
            "type":"string"
         },
         {
            "column":"label",
            "format":null,
            "prefix":"",
            "property":"Category",
            "suffix":"",
            "type":"string"
         },
         {
            "column":"score",
            "format":null,
            "prefix":"",
            "property":"Score",
            "suffix":"",
            "type":"numeric"
         }
      ]
   }
}